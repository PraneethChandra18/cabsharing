<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    {% load static %}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="{% static 'account/style.css' %}" type="text/css" />

    <title>{% block title %}CabShare{% endblock %}</title>
  </head>
  <body>
    <nav class="navbar navbar-expand-md bg-dark navbar-dark fixed-top">
      <a class="navbar-brand" href="{% url 'cabshare:index'%}"><span style="font-family:American Typewriter, serif">CabShare</span></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="topNavbar">
        <div class="mx-auto order-0">
          <form class="form-inline" action="{% url 'cabshare:search' %}" role="search" method="get" >
            <input class="form-control mr-sm-2" type="text" placeholder="Search for your destination" name="destination" value="{{ request.GET.destination }}">
            <input class="form-control mr-sm-2" type="date" name="date" value="{{ request.GET.date}}">
            <!-- <input class="form-control mr-sm-2" type="time" name="time" value="{{ request.GET.time}}"> -->

            <button class="btn btn-default" type="submit" style="background-color:white">Search</button>
          </form>
        </div>
<!-- <ul class="navbar-nav ml-auto justify-content-end">    ->Can also use this to make it align right-->
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="{% url 'cabshare:notifications' %}" data-toggle="tooltip" data-placement="bottom" title="Notifications"><span id="notifier"><i class="material-icons">notifications</i></span>&nbsp;</a>
          </li>

          <li class="nav-item">
            <a class="nav-link" href="{% url 'cabshare:booking-add' %}" data-toggle="tooltip" data-placement="bottom" title=" New Booking"><i class='fas fa-plus'></i>&nbsp;</a>
          </li>

          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown"><i class='fas fa-user'></i>&nbsp;</a>
            <div class="dropdown-menu dropdown-menu-right">
              <a class="dropdown-item" href="{% url 'account:profile-view' %}">Profile</a>
              <a class="dropdown-item" href="{% url 'cabshare:my_bookings' %}">My Bookings</a>
              <a class="dropdown-item" href="{% url 'cabshare:myrequests' %}">My Requests</a>
              <a class="dropdown-item" href="{% url 'cabshare:mychats' %}">My Chats</a>
              <a class="dropdown-item" href="{% url 'account:logout' %}">Logout</a>
            </div>
          </li>
        </ul>
      </div>
    </nav>
    <div class="container-fluid" style="margin-top:80px">
      {% block body %}
      {% endblock %}
    </div>

    <script type="text/javascript">
      const notificationSocket = new WebSocket('ws://'+ window.location.host+ '/ws/notification/');

      notificationSocket.onmessage = function(message) {
          var d = JSON.parse(message.data);
          var from_pk = {{user.pk}};
          if(d.to_user == from_pk)
          {
            $("#notifier").append("<i class='fas fa-dot-circle' style='color:red'></i>")
          }
      };

       $("#request").click(function() {
          var data = {
              from_user: $('#from_user_pk').val(),
              type: "request",
              to_user: $(this).attr('value'),
              message: "Request to join you on your ride",
          }
          notificationSocket.send(JSON.stringify(data));
          return false;
      });

      $("#accept").click(function() {
         var data = {
             from_user: $('#from_user_pk').val(),
             type: "accept",
             to_user: $(this).attr('value'),
             message: "Your request was accepted! Happy Journey!",
         }
         notificationSocket.send(JSON.stringify(data));
         return false;
     });

    </script>

  </body>
</html>
